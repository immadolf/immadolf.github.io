<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="weiyu luo,fqluowy@gmail.com"><title>二.如何使用Spring Shell · immadolf</title><meta name="description" content="二.使用Spring Shell让我们开始吧为了看看Spring Shell已经提供了哪些功能，让我们编写一个包含将两个数相加的命令的简单的shell应用程序。
让我们写一个简单的启动程序从版本2开始，Spring Shell已经完全重写，加入了各种增强功能，其中之一就是可以方便的和Spring B"><meta name="keywords" content="Hexo,Java,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">immadolf</a></h3><div class="description"><p>Nothing lasts forever.</p></div></div></div><ul class="social-links"><li><a href="http://github.com/immadolf"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>二.如何使用Spring Shell</a></h3></div><div class="post-content"><h2 id="二-使用Spring-Shell"><a href="#二-使用Spring-Shell" class="headerlink" title="二.使用Spring Shell"></a>二.使用Spring Shell</h2><h3 id="让我们开始吧"><a href="#让我们开始吧" class="headerlink" title="让我们开始吧"></a>让我们开始吧</h3><p>为了看看Spring Shell已经提供了哪些功能，让我们编写一个包含将两个数相加的命令的简单的shell应用程序。</p>
<h4 id="让我们写一个简单的启动程序"><a href="#让我们写一个简单的启动程序" class="headerlink" title="让我们写一个简单的启动程序"></a>让我们写一个简单的启动程序</h4><p>从版本2开始，Spring Shell已经完全重写，加入了各种增强功能，其中之一就是可以方便的和Spring Boot集成，尽管这并不是一个呼声很高的需求。出于本教程的目的，我们来创建一个简单的启动程序，比如使用<a href="https://start.spring.io" target="_blank" rel="noopener">start.spring.io</a>。这个简易的应用程序只需要依赖<code>spring-boot-starter</code>和配置<code>spring-boot-maven-plugin</code>，就可以生成一个可执行的über-jar:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<h4 id="添加Spring-Shell的依赖"><a href="#添加Spring-Shell的依赖" class="headerlink" title="添加Spring Shell的依赖"></a>添加Spring Shell的依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.shell<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-shell-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>鉴于这个依赖的存在，Spring Shell会引入并启动REPL(交互式编程环境)，所以你需要在整篇教程的构建活动中跳过测试或者你可以删除由<a href="https://start.spring.io" target="_blank" rel="noopener">start.spring.io</a>生成的集成在项目中的测试用例。而如果你不这样做的话，集成的测试用例将会创建一个Spring的<code>应用上下文(ApplicationContext)</code>，然后根据你的构建工具的不同，这个测试用例将会陷入死循环或者会因为NPE而崩溃。</p>
</blockquote>
<h4 id="你的第一个命令"><a href="#你的第一个命令" class="headerlink" title="你的第一个命令"></a>你的第一个命令</h4><p>是时候添加我们第一个命令了。创建一个新的类（名字随你喜欢）并用<code>@ShellComponent</code>（一个<code>@Component</code>的变体用来在扫描时与其他的组件区分）注解来标记它。</p>
<p>然后，创建一个<code>add</code>方法，它需要两个整数（<code>a</code>和<code>b</code>）并返回它们的和。用<code>@ShellMethod</code>注解来标记这个方法，并在这个注解中为这个方法提供一个描述信息（这也是这个注解唯一必需的信息）。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.shell.standard.ShellMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.shell.standard.ShellComponent;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ShellComponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCommands</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ShellMethod</span>(<span class="string">"Add two integers together."</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="让我们带它一程吧！（？？？不知道怎么翻译）"><a href="#让我们带它一程吧！（？？？不知道怎么翻译）" class="headerlink" title="让我们带它一程吧！（？？？不知道怎么翻译）"></a>让我们带它一程吧！（？？？不知道怎么翻译）</h4><p>构建应用程序，然后运行生成的jar，就像这样：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./mvnw clean install -DskipTests</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">java -jar target/demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure></p>
<p>你的屏幕上会出现这样的问候语（这个标语来自Spring Boot，如同往常一样它是可以自定义的）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&apos;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &apos;_ | &apos;_| | &apos;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &apos;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::        (v1.5.6.RELEASE)</span><br><span class="line"></span><br><span class="line">shell:&gt;</span><br></pre></td></tr></table></figure></p>
<p>下面是一个黄色的<code>shell:&gt;</code>提示，请你输入命令。输入<code>add 1 2</code>然后回车，接下来就是见证奇迹的时刻！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;add 1 2</span><br><span class="line">3</span><br></pre></td></tr></table></figure></p>
<p>尝试着玩玩这个shell（提示：试试输入<code>help</code>），当你想继续下一步的学习的时候就输入<code>exit</code>并回车。<br>这篇文档的剩余部分将会深入研究整个Spring Shell的编程模型。</p>
<h3 id="编写你自己的命令"><a href="#编写你自己的命令" class="headerlink" title="编写你自己的命令"></a>编写你自己的命令</h3><p>Spring Shell决定将一个方法转换成实际的shell命令的方式是完全可以插拔的（见扩展Spring Shell），但是在Spring Shell 2.x中，推荐使用在本节中介绍的新API来写一个命令（因此称为<em>标准</em> API）。<br>使用<em>标准</em> API，位于bean中的方法将会被转换成可执行的命令，需满足以下条件：</p>
<ul>
<li>用<code>@ShellComponent</code>注解修饰bean可以缩小被考虑的bean的集合。</li>
<li>用<code>@ShellMethod</code>注解修饰的方法<blockquote>
<p><code>@ShellComponent</code>注解是<code>@Component</code>的变种，因此除了过滤的功能以外，还可以用来声明bean（例如可以被<code>@ComponentScan</code>扫描到）。生成的bean的名称可以通过<code>value</code>属性指定。</p>
</blockquote>
</li>
</ul>
<h4 id="这是关于文档的一切信息！"><a href="#这是关于文档的一切信息！" class="headerlink" title="这是关于文档的一切信息！"></a>这是关于文档的一切信息！</h4><p><code>@ShellMethod</code>注解唯一必需的属性是<code>value</code>，它用一句简短的句子来描述这个命令是做什么的。这非常重要，以便您的用户无需离开shell就可以获得有关命令的一致帮助（请参阅帮助命令中的集成文档）。</p>
<blockquote>
<p>您命令的描述应该保持简短，只有一两句话。为了更好的一致性，强烈建议它以一个大写字母开头，以一个句号结尾。</p>
</blockquote>
<h4 id="自定义命令名"><a href="#自定义命令名" class="headerlink" title="自定义命令名"></a>自定义命令名</h4><p>默认情况下，不需要特意指定您命令的关键字。方法名会被用来作为命令的关键字，其中驼峰法会被转换成<code>-</code>，例如<code>sayHello()</code> 会变成 <code>say-hello</code>。<br>但是也可以通过指定注解的<code>key</code>属性来显式设置命令的关键字，就像这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ShellMethod</span>(value = <span class="string">"Add numbers."</span>, key = <span class="string">"sum"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>key</code>属性可以接收多个值。如果您对同一个方法设置了多个关键字，那么这个命令会分别用不同的别名来注册到系统中。<br>命令键可以包含几乎任何字符，包括空格。当设计名字时，请记住用户常常赞赏一致性（即避免混合使用间隔名称的虚线名称等）。</p>
</blockquote>
<h3 id="调用您的命令"><a href="#调用您的命令" class="headerlink" title="调用您的命令"></a>调用您的命令</h3><h4 id="命名参数与位置参数"><a href="#命名参数与位置参数" class="headerlink" title="命名参数与位置参数"></a>命名参数与位置参数</h4><p>如之前所见，用<code>@ShellMethod</code>修饰方法是创建一个命令的唯一的条件。当创建了一个命令以后，用户可以通过两种方式来为方法的参数赋值：</p>
<ul>
<li>使用参数的key（e.g. <code>--arg value</code>）。这种途径被称为是命名参数赋值。</li>
<li>如果不用key，可以按照方法签名中参数的顺序给参数赋值。也就是按位置赋值。</li>
</ul>
<p>这两种方式可以混合使用，只是命令参数的方式的优先级会更高（因为更加不容易有歧义）。因此，请看一下命令：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ShellMethod</span>(<span class="string">"Display stuff."</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">echo</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"You said a=%d, b=%d, c=%d"</span>, a, b, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那么下面的调用都是等价的，如输出所见：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;echo 1 2 3               //1</span><br><span class="line">You said a=1, b=2, c=3</span><br><span class="line"></span><br><span class="line">shell:&gt;echo --a 1 --b 2 --c 3   //2</span><br><span class="line">You said a=1, b=2, c=3</span><br><span class="line"></span><br><span class="line">shell:&gt;echo --b 2 --c 3 --a 1   //3</span><br><span class="line">You said a=1, b=2, c=3</span><br><span class="line"></span><br><span class="line">shell:&gt;echo --a 1 2 3           //4</span><br><span class="line">You said a=1, b=2, c=3</span><br><span class="line"></span><br><span class="line">shell:&gt;echo 1 --c 3 2           //5</span><br><span class="line">You said a=1, b=2, c=3</span><br></pre></td></tr></table></figure></p>
<p>| 1 | 按参数定义的位置赋值<br>| 2 | 按参数的key赋值<br>| 3 | 按参数的key赋值时，参数的位置可以随意调换<br>| 4 | 可以对两种方式进行混合<br>| 5 | 非命名参数按它们出现的顺序赋值</p>
<h5 id="自定义命名参数的key"><a href="#自定义命名参数的key" class="headerlink" title="自定义命名参数的key"></a>自定义命名参数的key</h5><p>如上所示，key的默认生成策略是根据方法签名中参数的java名称加上两个破折号作为前缀(–)。有两种方法来对其进行自定义：</p>
<ol>
<li>使用<code>@ShellMethod</code>注解中的<code>prefix()</code>属性来改变整个方法的默认前缀</li>
<li>用<code>@ShellOption</code>注解标注参数以修改单个参数的key</li>
</ol>
<p>看一看下面的整个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ShellMethod</span>(value = <span class="string">"Display stuff."</span>, prefix=<span class="string">"-"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">echo</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, @ShellOption(<span class="string">"--third"</span>)</span> <span class="keyword">int</span> c) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"You said a=%d, b=%d, c=%d"</span>, a, b, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对于这样的设置，参数的key就变成了<code>-a</code>, <code>-b</code> 和 <code>--third</code>。</p>
<blockquote>
<p>为一个参数指定多个key是可行的。这些key之间是互斥的。作为示例，以下是内置帮助命令的签名：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;  <span class="meta">@ShellMethod</span>(<span class="string">"Describe a command."</span>)</span><br><span class="line">&gt;  <span class="function"><span class="keyword">public</span> String <span class="title">help</span><span class="params">(@ShellOption(&#123;<span class="string">"-C"</span>, <span class="string">"--command"</span>&#125;)</span> String command) </span>&#123;</span><br><span class="line">&gt;            ...</span><br><span class="line">&gt;  &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="可选参数与默认值"><a href="#可选参数与默认值" class="headerlink" title="可选参数与默认值"></a>可选参数与默认值</h4><p>Spring Shell提供了设置参数默认值的能力，这样用户就可以省略这些有默认值的参数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ShellMethod</span>(<span class="string">"Say hello."</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">greet</span><span class="params">(@ShellOption(defaultValue=<span class="string">"World"</span>)</span> String who) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello "</span> + who;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在，<code>greet</code>命名既可以像<code>greet Mother</code> (或 <code>greet --who Mother</code>)这样调用，也可以像下面这样调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;greet</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure></p>
<h4 id="参数元数"><a href="#参数元数" class="headerlink" title="参数元数"></a>参数元数</h4><p>到目前为止，我们始终假设每个参数都映射到用户输入的一个值。当参数是多个值时，情况就会变成不一样。<code>@ShellOption</code> 注解的<code>arity()</code>属性提供了这样的能力。只需使用集合或数组作为参数类型，并指定期望值的数量：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ShellMethod</span>(<span class="string">"Add Numbers."</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">add</span><span class="params">(@ShellOption(arity=<span class="number">3</span>)</span> <span class="keyword">float</span>[] numbers) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numbers[<span class="number">0</span>] + numbers[<span class="number">1</span>] + numbers[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后可以使用以下任意语法调用该命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;add 1 2 3.3</span><br><span class="line">6.3</span><br><span class="line">shell:&gt;add --numbers 1 2 3.3</span><br><span class="line">6.3</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>使用命名参数方法时，不应重复该参数的key。 如以下调用会失败：<br>shell:&gt;add –numbers 1 –numbers 2 –numbers 3.3</p>
</blockquote>
<h5 id="无穷元数"><a href="#无穷元数" class="headerlink" title="无穷元数"></a>无穷元数</h5><p>待完成</p>
<h5 id="布尔参数的特殊处理"><a href="#布尔参数的特殊处理" class="headerlink" title="布尔参数的特殊处理"></a>布尔参数的特殊处理</h5><p>当涉及参数元数时，正如命令行中常见的那样，存在一些会被特殊对待的参数。布尔类型的参数表现出来的行为像是它的<code>arity()</code>默认为0一样，用户可以通过设置”flag”来设置它的值。参考下面的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ShellMethod</span>(<span class="string">"Terminate the system."</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">shutdown</span><span class="params">(<span class="keyword">boolean</span> force)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"You said "</span> + force;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个命令允许以下的调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;shutdown</span><br><span class="line">You said false</span><br><span class="line">shell:&gt;shutdown --force</span><br><span class="line">You said true</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>这种特殊的处理方式与默认值相符。 尽管布尔参数的默认值是false，但您可以将其指定为其他值（如@ShellOption（defaultValue =“true”）），这样行为将被反转（即，不指定参数将导致值为true，而指定该标志将导致该值为false）</p>
<p>隐式的arity()=0可以防止用户指定一个值(如，shutdown –force true)。如果您更偏好这样的行为（而不是通过设定flag），那么可以强制指定arity()=1：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="meta">@ShellMethod</span>(<span class="string">"Terminate the system."</span>)</span><br><span class="line">&gt; <span class="function"><span class="keyword">public</span> String <span class="title">shutdown</span><span class="params">(@ShellOption(arity=<span class="number">1</span>, defaultValue=<span class="string">"false"</span>)</span> <span class="keyword">boolean</span> force) </span>&#123;</span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="string">"You said "</span> + force;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="引号处理"><a href="#引号处理" class="headerlink" title="引号处理"></a>引号处理</h4><p>Spring Shell接收用户的输入并以空格为分隔来标记这些词。当用户希望输入一个带空格的参数值时，就需要用引号来包裹这个值。单引号和双引号都可以，并且用来包裹的引号不会出现在参数值中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ShellMethod</span>(<span class="string">"Prints what has been entered."</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">echo</span><span class="params">(String what)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"You said "</span> + what;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同时支持单引号和双引号允许用户轻松地将一种类型的引号嵌入到值中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;echo &quot;I&apos;m here!&quot;</span><br><span class="line">You said I&apos;m here!</span><br><span class="line">shell:&gt;echo &apos;He said &quot;Hi!&quot;&apos;</span><br><span class="line">You said He said &quot;Hi!&quot;</span><br></pre></td></tr></table></figure></p>
<p>当用户需要在值中包含与包裹整个值相同的引号时，需要使用转义符(<code>\</code>):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;echo &apos;I\&apos;m here!&apos;</span><br><span class="line">You said I&apos;m here!</span><br><span class="line">shell:&gt;echo &quot;He said \&quot;Hi!\&quot;&quot;</span><br><span class="line">You said He said &quot;Hi!&quot;</span><br><span class="line">shell:&gt;echo I\&apos;m here!</span><br><span class="line">You said I&apos;m here!</span><br></pre></td></tr></table></figure></p>
<p>当然也可以用转义符来转义空格而不用引号来包裹：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;echo This\ is\ a\ single\ value</span><br><span class="line">You said This is a single value</span><br></pre></td></tr></table></figure></p>
<h4 id="与Shell交互"><a href="#与Shell交互" class="headerlink" title="与Shell交互"></a>与Shell交互</h4><p>Spring Shell项目建立在JLine库之上，因此带来了许多不错的交互功能，其中一些在本节中有详细介绍。<br>首先，也是最重要的，Spring Shell支持在几乎所有的地方用<code>tab</code>进行补全。所以，如果存在一个<code>echo</code>命令，当用户输入<code>e</code>，<code>c</code>，<code>tab</code>，<code>echo</code>就会出现。如果存在几个以<code>ec</code>开头的命令，则会提示用户选择(使用 <code>tab</code> 或 <code>Shift+tab</code> 进行导航, 然后回车确认)。</p>
<p>补全功能不仅限于命令的key。如果应用的开发者注册了合适的beans，它也可以用以补全参数的key，甚至是参数的值。</p>
<p>另一个很棒的功能是Spring Shell程序支持连续行。如果一个命令和它的参数太长以至于在屏幕上显示不完整，用户可以将它分块，通过输入反斜杠<code>\</code>终止一行并输入回车以新起一行继续输入。提交整个命令时，这些反斜杠会被解析成一个空格。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;register module --type source --name foo  \ //1</span><br><span class="line">&gt; --uri file:///tmp/bar</span><br><span class="line">Successfully registered module &apos;source:foo&apos;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>| 1 | 命令在下一行继续</p>
</blockquote>
<p>当用户在被引号包裹的地方敲击回车，连续行会被自动启用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell:&gt;echo &quot;Hello //1</span><br><span class="line">dquote&gt; World&quot;</span><br><span class="line">You said Hello World</span><br></pre></td></tr></table></figure>
<blockquote>
<p>| 1 | 在这输入回车</p>
</blockquote>
<p>最后，Spring Shell应用程序借鉴了许多你可能在日常使用的操作系统已经熟悉的Emacs快捷键。显著的快捷键包括<code>ctrl</code> + <code>r</code>反向搜索，<code>ctrl</code> + <code>a</code> 和 <code>ctrl</code> + <code>e</code>分别移动到行首和行尾，<code>esc f</code> 和 <code>esc b</code>一次向前（后）移动一个字符。</p>
<h3 id="校验命令参数"><a href="#校验命令参数" class="headerlink" title="校验命令参数"></a>校验命令参数</h3><p>Spring Shell集成了Bean Validation API以支持在命令参数上进行自动的和自描述的约束。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-03-13</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Spring-Shell/" title="Spring-Shell">Spring-Shell </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://immadolf.github.io/2018/03/13/二.如何使用Spring-Shell/,immadolf,二.如何使用Spring Shell,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/03/17/Spring-Conversion学习/" title="Spring Conversion学习">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/03/13/一.Spring Shell是什么/" title="一.Spring Shell是什么">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>